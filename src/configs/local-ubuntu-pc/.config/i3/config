#########################################################################################################################
################################################ Defaults (Shared) ######################################################
#########################################################################################################################

# This file has been auto-generated by i3-config-wizard(1).
# It will not be overwritten, so edit it as you like.
#
# Should you change your keyboard layout some time, delete
# this file and re-run i3-config-wizard(1).
#

# i3 config file (v4)
#
# Please see https://i3wm.org/docs/userguide.html for a complete reference!

# This font is widely installed, provides lots of unicode glyphs, right-to-left
# text rendering and scalability on retina/hidpi displays (thanks to pango).
#font pango:DejaVu Sans Mono 8

# Before i3 v4.8, we used to recommend this one as the default:
# font -misc-fixed-medium-r-normal--13-120-75-75-C-70-iso10646-1
# The font above is very space-efficient, that is, it looks good, sharp and
# clear in small sizes. However, its unicode glyph coverage is limited, the old
# X core fonts rendering does not support right-to-left and this being a bitmap
# font, it doesnâ€™t scale on retina/hidpi displays.

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# kill focused window
bindsym $mod+Shift+q kill

# change focus
bindsym $mod+j focus left
bindsym $mod+k focus down
bindsym $mod+l focus up
bindsym $mod+semicolon focus right

# alternatively, you can use the cursor keys:
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# move focused window
bindsym $mod+Shift+j move left
bindsym $mod+Shift+k move down
bindsym $mod+Shift+l move up
bindsym $mod+Shift+semicolon move right

# alternatively, you can use the cursor keys:
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# split in horizontal orientation
bindsym $mod+Shift+h split h

# split in vertical orientation
bindsym $mod+Shift+v split v

# enter fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# change focus between tiling / floating windows
bindsym mod1+space focus mode_toggle

# focus the parent container
bindsym $mod+a focus parent

# focus the child container
#bindsym $mod+d focus child

# switch to workspacez
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9
bindsym $mod+0 workspace number 10

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4
bindsym $mod+Shift+5 move container to workspace number 5
bindsym $mod+Shift+6 move container to workspace number 6
bindsym $mod+Shift+7 move container to workspace number 7
bindsym $mod+Shift+8 move container to workspace number 8
bindsym $mod+Shift+9 move container to workspace number 9
bindsym $mod+Shift+0 move container to workspace number 10

# reload the configuration file
bindsym $mod+Shift+c reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart
# exit i3 (logs you out of your X session)
bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -B 'Yes, exit i3' 'i3-msg exit'"

#########################################################################################################################
############################################# Custom Configurations (Shared) ############################################
#########################################################################################################################

##============================================== basics and globals ===========================================##

# set $mod to Win key
set $mod mod4

# define a color scheme
set $med_gray   #cccccc
set $light_gray #eeeeee
set $charcoal   #505050
set $sky_blue   #2e9ef4
set $ocean_blue #285577
set $obsidian   #292d2e
set $light_red  #ff8888
set $eggshell   #efefef

set $alacritty 	/home/<USER>/.cargo/bin/alacritty

focus_follows_mouse no

##=========================================== system modifications ============================================##

exec --no-startup-id google-drive-ocamlfuse /home/<USER>/Drive/G/

##=========================================== initialize desktop environment ==================================##

# window compositor
exec_always --no-startup-id picom --config ~/.config/picom.conf -b
# set initial window gaps
gaps inner 3
# disable window titles (enables gaps to work properly)
for_window [class="^.*"] border pixel 0

# dynamically name workspaces based on focused window
exec --no-startup-id ~/.config/i3/sh/workspace_names.sh

# window decoration
# class                 border     background  text    	 indicator   child_border
client.focused          $med_gray $light_gray $charcoal $sky_blue   $ocean_blue
client.focused_inactive $med_gray $med_gray  $charcoal $charcoal   $charcoal
client.unfocused        $med_gray $med_gray  $charcoal $obsidian   $obsidian
client.urgent           $obsidian  $light_red  $eggshell $light_red  $light_red
client.placeholder      $obsidian  $obsidian   $eggshell $obsidian   $obsidian
client.background       $eggshell

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
font pango:System San Francisco Display 6

# Start i3bar to display a workspace bar (plus the system information i3status
# finds out, if available)
bar {
	output DP-5
	output HDMI-0
	# output HDMI-1-2
	output DVI-D-0
	# output DP-3

	position top

	tray_output primary

	# make bar transparent
	colors {
		# set alpha channel lower for more transparent
		background $eggshell
		statusline $charcoal
		separator  $charcoal
		
		# workspace icons widget
		# class		   border  backgr. text
   	        focused_workspace  $med_gray  $med_gray  $charcoal
   	        active_workspace   $light_gray $light_gray $charcoal
   	        inactive_workspace $light_gray $light_gray $charcoals
   	        urgent_workspace   $light_red  $charcoal   $eggshell	
	}

	i3bar_command i3bar -t	
	status_command i3blocks
}

# start dmenu (a program launcher)
#bindsym $mod+d exec dmenu_run -fn "System San Francisco-14"
# replaced dmenu with rofi launcher
bindsym $mod+d exec --no-startup-id rofi -show drun -display-drun "" -show-icons
bindsym $mod+space exec --no-startup-id rofi -show drun -display-drun "" -show-icons
bindsym $mod+g exec --no-startup-id rofi -show window -show-icons
bindsym $mod+Tab exec --no-startup-id rofi -show window -show-icons

# reset modular scratchpads
#TODO

# round corners
# NOTE: as of 29 Feb, 2020, this line requires using this fork of i3-gaps:
#  	https://github.com/resloved/i3.git
#border_radius 4
# NOTE: moved to picom for rounded corners

# configure display connections, orientations, resolutions (xrandr)
exec_always --no-startup-id ~/.config/i3/sh/xrandr-layout.sh

# kill any zombie background slideshows and start a new slideshow
exec_always --no-startup-id pkill bg-slideshow.sh
exec_always --no-startup-id (sleep 0.1 && ~/.config/i3/sh/bg-slideshow.sh) 

# start conky widgets
exec --no-startup-id  ( sleep 15 \
			&& ~/bin/conky/launch_conkies.sh \
			&& sleep 1 \
			&& cpu_conky_exec.sh )
exec --no-startup-id ( sleep 30 \
      && (for i in $(seq 10); do sleep 100 && /home/<USER>/bin/conky/cpu_conky_exec.sh)))

##================================================= keybindings ==============================================##

# toggle status bar
bindsym $mod+Shift+b bar mode toggle

# move focus to different workspaces                                               
# move to most recent workspace                                                    
bindsym $mod+BackSpace workspace back_and_forth                                    
# move to previous and next (by number, not history) workspaces                    
bindsym $mod+bracketleft workspace prev                                            
bindsym $mod+bracketright workspace next    

# move focused workspace to different screen
bindsym $mod+Control+Left move workspace to output left
bindsym $mod+Control+Right move workspace to output right

# mouse keys
set $fast    260
set $precise 18
set $move_mouse exec xdotool mousemove_relative
set $left_click exec xdotool mousemove_relative 0 0 click 1
set $scroll_click exec xdotool mousemove_relative 0 0 click 2
set $rght_click exec xdotool mousemove_relative 0 0 click 3

bindsym $mod+mod1+Left   $move_mouse -- -$precise  0 
bindsym $mod+mod1+Up     $move_mouse --  0     -$precise
bindsym $mod+mod1+Right	 $move_mouse     $precise 0
bindsym $mod+mod1+Down	 $move_mouse     0    $precise
bindsym $mod+mod1+Return 	    $left_click	#TODO: troubleshoot
bindsym $mod+mod1+f 	        $left_click	#TODO: troubleshoot
bindsym $mod+mod1+backslash   $rght_click
bindsym $mod+mod1+s           $rght_click

bindsym $mod+mod1+Shift+Left   $move_mouse -- -$fast  0 
bindsym $mod+mod1+Shift+Up     $move_mouse --  0     -$fast
bindsym $mod+mod1+Shift+Right  $move_mouse     $fast 0
bindsym $mod+mod1+Shift+Down   $move_mouse     0    $fast
bindsym $mod+mod1+Shift+Return $left_click
bindsym $mod+mod1+Shift+f      $left_click
bindsym $mod+mod1+Shift+backslash $rght_click
bindsym $mod+mod1+Shift+s         $rght_click


bindsym KP_Left   $move_mouse -- -$precise  0 
bindsym KP_Up     $move_mouse --  0     -$precise
bindsym KP_Right  $move_mouse     $precise 0
bindsym KP_Down   $move_mouse     0    $precise
bindsym KP_Home   $move_mouse -- -$precise -$precise 
bindsym KP_Prior  $move_mouse -- -$precise  $precise
bindsym KP_Next   $move_mouse     $precise  $precise
bindsym KP_End    $move_mouse     $precise  -$precise
bindsym Shift+KP_Left   $move_mouse -- -$fast  0 
bindsym Shift+KP_Up     $move_mouse --  0     -$fast
bindsym Shift+KP_Right  $move_mouse     $fast 0
bindsym Shift+KP_Down   $move_mouse     0    $fast
bindsym Shift+KP_Home   $move_mouse -- -$fast -$fast 
bindsym Shift+KP_Prior  $move_mouse -- -$fast  $fast
bindsym Shift+KP_Next   $move_mouse     $fast  $fast
bindsym Shift+KP_End    $move_mouse     $fast  -$fast
bindsym KP_Begin  $left_click
bindsym $mod+KP_Begin $rght_click

mode "mouse" {

	# set your three speeds here

	set $slow 12
	set $quick 54
	set $fast 256

	# Mouse movement (slow/fine-tuned) -- vim keybindings

	bindsym h exec xdotool mousemove_relative -- -$slow 0
	bindsym j exec xdotool mousemove_relative 0 $slow
	bindsym k exec xdotool mousemove_relative -- 0 -$slow
	bindsym l exec xdotool mousemove_relative $slow 0

	# Mouse movement (slow/fine-tuned) -- arrow keys

	bindsym Left exec xdotool mousemove_relative -- -$slow 0
	bindsym Down exec xdotool mousemove_relative 0 $slow
	bindsym Up exec xdotool mousemove_relative -- 0 -$slow
	bindsym Right exec xdotool mousemove_relative $slow 0

	# Mouse movement (quicker) -- vim keybindings

	bindsym mod1+h exec xdotool mousemove_relative -- -$quick 0
	bindsym mod1+j exec xdotool mousemove_relative 0 $quick
	bindsym mod1+k exec xdotool mousemove_relative -- 0 -$quick
	bindsym mod1+l exec xdotool mousemove_relative $quick 0
	bindsym $mod+h exec xdotool mousemove_relative -- -$quick 0
	bindsym $mod+j exec xdotool mousemove_relative 0 $quick
	bindsym $mod+k exec xdotool mousemove_relative -- 0 -$quick
	bindsym $mod+l exec xdotool mousemove_relative $quick 0
	bindsym Shift+h exec xdotool mousemove_relative -- -$quick 0
	bindsym Shift+j exec xdotool mousemove_relative 0 $quick
	bindsym Shift+k exec xdotool mousemove_relative -- 0 -$quick
	bindsym Shift+l exec xdotool mousemove_relative $quick 0

	# Mouse movement (quicker) -- arrow keys

	bindsym mod1+Left exec xdotool mousemove_relative -- -$quick 0
	bindsym mod1+Down exec xdotool mousemove_relative 0 $quick
	bindsym mod1+Up exec xdotool mousemove_relative -- 0 -$quick
	bindsym mod1+Right exec xdotool mousemove_relative $quick 0
	bindsym $mod+Left exec xdotool mousemove_relative -- -$quick 0
	bindsym $mod+Down exec xdotool mousemove_relative 0 $quick
	bindsym $mod+Up exec xdotool mousemove_relative -- 0 -$quick
	bindsym $mod+Right exec xdotool mousemove_relative $quick 0
	bindsym Shift+Left exec xdotool mousemove_relative -- -$quick 0
	bindsym Shift+Down exec xdotool mousemove_relative 0 $quick
	bindsym Shift+Up exec xdotool mousemove_relative -- 0 -$quick
	bindsym Shift+Right exec xdotool mousemove_relative $quick 0

	# Mouse movement (fast) -- vim keybindings

	bindsym Shift+mod1+h exec xdotool mousemove_relative -- -$fast 0
	bindsym Shift+mod1+j exec xdotool mousemove_relative 0 $fast
	bindsym Shift+mod1+k exec xdotool mousemove_relative -- 0 -$fast
	bindsym Shift+mod1+l exec xdotool mousemove_relative $fast 0
	bindsym $mod+mod1+h exec xdotool mousemove_relative -- -$fast 0
	bindsym $mod+mod1+j exec xdotool mousemove_relative 0 $fast
	bindsym $mod+mod1+k exec xdotool mousemove_relative -- 0 -$fast
	bindsym $mod+mod1+l exec xdotool mousemove_relative $fast 0
	bindsym Shift+$mod+h exec xdotool mousemove_relative -- -$fast 0
	bindsym Shift+$mod+j exec xdotool mousemove_relative 0 $fast
	bindsym Shift+$mod+k exec xdotool mousemove_relative -- 0 -$fast
	bindsym Shift+$mod+l exec xdotool mousemove_relative $fast 0
	bindsym Shift+$mod+mod1+h exec xdotool mousemove_relative -- -$fast 0
	bindsym Shift+$mod+mod1+j exec xdotool mousemove_relative 0 $fast
	bindsym Shift+$mod+mod1+k exec xdotool mousemove_relative -- 0 -$fast
	bindsym Shift+$mod+mod1+l exec xdotool mousemove_relative $fast 0

	# Mouse movement (fast) -- arrow keys

	bindsym Shift+mod1+Left exec xdotool mousemove_relative -- -$fast 0
	bindsym Shift+mod1+Down exec xdotool mousemove_relative 0 $fast
	bindsym Shift+mod1+Up exec xdotool mousemove_relative -- 0 -$fast
	bindsym Shift+mod1+Right exec xdotool mousemove_relative $fast 0
	bindsym $mod+mod1+Left exec xdotool mousemove_relative -- -$fast 0
	bindsym $mod+mod1+Down exec xdotool mousemove_relative 0 $fast
	bindsym $mod+mod1+Up exec xdotool mousemove_relative -- 0 -$fast
	bindsym $mod+mod1+Right exec xdotool mousemove_relative $fast 0
	bindsym Shift+$mod+Left exec xdotool mousemove_relative -- -$fast 0
	bindsym Shift+$mod+Down exec xdotool mousemove_relative 0 $fast
	bindsym Shift+$mod+Up exec xdotool mousemove_relative -- 0 -$fast
	bindsym Shift+$mod+Right exec xdotool mousemove_relative $fast 0
	bindsym Shift+$mod+mod1+Left exec xdotool mousemove_relative -- -$fast 0
	bindsym Shift+$mod+mod1+Down exec xdotool mousemove_relative 0 $fast
	bindsym Shift+$mod+mod1+Up exec xdotool mousemove_relative -- 0 -$fast
	bindsym Shift+$mod+mod1+Right exec xdotool mousemove_relative $fast 0

	# Left Click
	bindsym f exec xdotool click 1
	bindsym $mod+Return exec xdotool click 1

	# Middle Click
	bindsym d exec xdotool click 2

	# Right Click
	bindsym s exec xdotool click 3
	bindsym $mod+backslash exec xdotool click 3

  # Scroll
  bindsym $mod+space exec xdotool click 4
  bindsym g exec xdotool click 4
  bindsym a exec xdotool click 5
  bindsym v exec xdotool click 5
  bindsym $mod+g exec /usr/local/bin/xdotool/mouse_scroll.sh up_fast
  bindsym $mod+a exec /usr/local/bin/xdotool/mouse_scroll.sh down_fast
  bindsym $mod+v exec /usr/local/bin/xdotool/mouse_scroll.sh down_fast
  bindsym Shift+g exec /usr/local/bin/xdotool/mouse_scroll.sh up_fast
  bindsym Shift+a exec /usr/local/bin/xdotool/mouse_scroll.sh down_fast
  bindsym Shift+v exec /usr/local/bin/xdotool/mouse_scroll.sh down_fast

	# Left Click-and-drag
	bindsym Shift+f exec xdotool mousedown 1

	# Middle Click-and-drag 
	bindsym Shift+d exec xdotool mousedown 2

	# Right Click-and-drag
	bindsym Shift+s exec xdotool mousedown 3

	# Left Drag release
	bindsym mod1+f exec xdotool mouseup 1

	# Middle Drag release
	bindsym mod1+d exec xdotool mouseup 2

	# Right Drag release
	bindsym mod1+s exec xdotool mouseup 3

	# return to normal keybindings -- IMPORTANT!!

	bindsym Escape mode "default"
	bindsym $mod+mod1+m mode "default"
}

bindsym $mod+mod1+m mode "mouse"

# change window gap
set $window_gap_inc 3
bindsym $mod+Control+period gaps inner current minus $window_gap_inc
bindsym $mod+Control+comma  gaps inner current plus  $window_gap_inc

# change window size
bindsym $mod+Shift+m      resize shrink width  5 px or 5 ppt
bindsym $mod+Shift+comma  resize shrink height 5 px or 5 ppt
bindsym $mod+Shift+period resize grow   height 5 px or 5 ppt
bindsym $mod+Shift+slash  resize grow   width  5 px or 5 ppt

# zen mode
#TODO: implement zen mode

# move the currently focused window to the scratchpad
bindsym $mod+Shift+minus move scratchpad
# Show the next scratchpad window or hide the focused scratchpad window.
# If there are multiple scratchpad windows, this command cycles through them.
bindsym $mod+minus exec --no-startup-id i3-msg scratchpad show && i3-msg move position center

# TODO: prune unused scratchpads 
# modular scratchpads. Create if window doesn't exist, otherwise show
bindsym mod1+t exec --no-startup-id ~/.config/i3/sh/scratchpad/trello.todo.sh
bindsym mod1+j exec --no-startup-id ~/.config/i3/sh/scratchpad/joplin.sh
bindsym mod1+Shift+j exec --no-startup-id ~/.config/i3/sh/scratchpad/trello.notes.sh
bindsym mod1+Shift+d exec --no-startup-id ~/.config/i3/sh/scratchpad/draw.sh
bindsym mod1+a exec --no-startup-id ~/.config/i3/sh/scratchpad/trello.work.sh
bindsym mod1+c exec --no-startup-id ~/.config/i3/sh/scratchpad/calendar.sh
# bindsym mod1+u exec --no-startup-id ~/.config/i3/sh/scratchpad/termite.shell.sh
bindsym mod1+u exec --no-startup-id ~/.config/i3/sh/scratchpad/alacritty.shell.sh
bindsym mod1+F11 exec --no-startup-id ~/.config/i3/sh/scratchpad/bc-calc.shell.sh >> ~/.cache/.workflow/alacritty.log 2>&1
bindsym mod1+i exec --no-startup-id ~/.config/i3/sh/scratchpad/ranger.shell.sh
# TODO: get barrier working?
# bindsym mod1+b exec --no-startup-id ~/.config/i3/sh/scratchpad/barrier.sh
bindsym mod1+w exec --no-startup-id ~/.config/i3/sh/scratchpad/chrome.window.homer.sh
bindsym mod1+m exec --no-startup-id ~/.config/i3/sh/scratchpad/spotify.sh
bindsym mod1+n exec --no-startup-id ~/.config/i3/sh/scratchpad/pocketcasts.sh
bindsym mod1+r exec --no-startup-id ~/.config/i3/sh/scratchpad/research.sh
bindsym mod1+s exec --no-startup-id ~/.config/i3/sh/scratchpad/translate.sh
bindsym mod1+g exec --no-startup-id ~/.config/i3/sh/scratchpad/maps.sh
bindsym mod1+F9 exec --no-startup-id ~/.config/i3/sh/scratchpad/gmail.sh
bindsym Print exec --no-startup-id ~/.config/i3/sh/scratchpad/screenshot.sh
bindsym $mod+v exec --no-startup-id ~/.config/i3/sh/scratchpad/screen-recording.sh
bindsym $mod+i exec --no-startup-id ~/.config/i3/sh/scratchpad/i3help.sh
bindsym mod1+F12 exec --no-startup-id ~/.config/i3/sh/scratchpad/chatgpt.sh >> ~/.cache/.workflow/alacritty.log 2>&1

# read 1 character and mark the current window with this character
bindsym $mod+m exec i3-input -F 'mark %s' -l 10 -P 'Mark: '

# read 1 character and go to the window with the character
bindsym $mod+Shift+g exec i3-input -F '[con_mark="%s"] focus' -l 10 -P 'Goto: '

# Uncomment if no local config
bindsym $mod+Return exec /home/<USER>/.cargo/bin/alacritty

# volume control
bindsym F2 exec --no-startup-id ~/bin/pactl/volume_controller.sh dec_volume 10 >> $HOME/.cache/.workflow/i3.log
bindsym XF86LowerVolume exec --no-startup-id ~/bin/pactl/volume_controller.sh dec_volume 10 >> $HOME/.cache/.workflow/i3.log
bindsym F3 exec --no-startup-id ~/bin/pactl/volume_controller.sh inc_volume 10 >> $HOME/.cache/.workflow/i3.log
bindsym XF86RaiseVolume exec --no-startup-id ~/bin/pactl/volume_controller.sh inc_volume 10 >> $HOME/.cache/.workflow/i3.log
bindsym F4 exec --no-startup-id ~/bin/pactl/volume_controller.sh mute
bindsym XF86AudioMute exec --no-startup-id ~/bin/pactl/volume_controller.sh mute

# lock screen
bindsym Pause exec --no-startup-id ~/.config/i3/sh/lock.sh
exec_always --no-startup-id xautolock -time 10 -locker "$HOME/.config/i3/sh/lock.sh" -notify 10 \
     >> $HOME/.cache/.workflow/i3.log &

# additional machine-specific scratchpads

bindsym mod1+p exec --no-startup-id ~/bin/i3_util/i3_run_mark_scratchpad.sh \
  '/home/<USER>/.cargo/bin/alacritty --title="Picocluster" -e /home/sthinds/bin/ssh/picocluster-ssh.sh' \
		"Picocluster" 1.0 1120 774

bindsym mod1+h exec --no-startup-id ~/bin/i3_util/i3_run_mark_scratchpad.sh \
	'/home/<USER>/.cargo/bin/alacritty --title="HomeAssistant" -e /home/sthinds/bin/ssh/homeassistant-ssh.sh' \
        "HomeAssistant" 1.0 1120 774

bindsym mod1+o exec --no-startup-id ~/bin/i3_util/i3_run_mark_scratchpad.sh \
	'/home/<USER>/.cargo/bin/alacritty --title="Openmediavault" -e /home/sthinds/bin/ssh/openmediavault-ssh.sh' \
        "Openmediavault" 1.0 1120 774

bindsym mod1+b exec --no-startup-id ~/bin/i3_util/i3_run_mark_scratchpad.sh \
	'/home/<USER>/.cargo/bin/alacritty --title="gssbuild" -e /home/sthinds/bin/ssh/gssbuild-ssh.sh' \
		"gssbuild" 1.0 1120 774
